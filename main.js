(()=>{"use strict";var e=document.querySelector(".profile__button-change"),t=document.querySelector(".profile__button-add"),n=(document.querySelectorAll(".pop-up__btn-close"),document.querySelector(".profile__title")),o=document.querySelector(".profile__subtitle"),r=document.querySelector(".profile__avatar"),c=document.querySelector(".profile__edit-avatar"),a=document.querySelector(".profile__avatar-change"),i=document.querySelector(".gallery__list"),u=document.querySelectorAll(".pop-up"),l=document.querySelector(".pop-up__profile"),s=document.querySelector(".pop-up__place"),d=document.querySelector(".pop-up__avatar"),f=document.querySelector("#profile-forms"),p=document.querySelector("#avatar-forms"),m=document.querySelector("#profile-name"),v=document.querySelector("#profile-description"),y=document.querySelector("#profile-avatar"),h=document.querySelector("#place-forms"),_=document.querySelector("#place-name"),b=document.querySelector("#place-description"),S=document.querySelector(".pop-up__image"),g=document.querySelector(".pop-up__gallery-image"),q=document.querySelector(".pop-up__desctiption-image"),L="pop-up__btn-save_inactive",E="pop-up_opened",C="profile__avatar-change_active",k="gallery__button-like_active",A=".gallery__item",x={baseUrl:"https://nomoreparties.co/v1/plus-cohort-8/",headers:{Authorization:"ea0f5ff1-1f3b-4f72-b28c-164c5b7a6982","Content-type":"application/json"}},w=function(e){return e.ok?e.json():Promise.reject(e)};function U(e,t,n,o,r,c,a){var i=document.querySelector("#card").content.querySelector(A).cloneNode(!0),u=i.querySelector(".gallery__pic"),l=i.querySelector(".gallery__item-descriprion"),s=i.querySelector(".gallery__button-like"),d=i.querySelector(".gallery__button-delete"),f=i.querySelector(".gallery__show-like");return u.src="".concat(e),u.alt="".concat(t),u.dataset.id=c,l.textContent="".concat(t),f.textContent="".concat(n),u.addEventListener("click",(function(){g.src="".concat(e),g.alt="".concat(t),q.textContent="".concat(t),j(S)})),o===r?d.addEventListener("click",(function(e){(function(e){return fetch("".concat(x.baseUrl,"cards/").concat(e),{method:"DELETE",headers:x.headers}).then(w)})(c).then((function(){!function(e){e.target.closest(A).remove()}(e)})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)}))})):d.remove(),a.includes(o)&&s.classList.add(k),s.addEventListener("click",(function(e){!function(e,t,n){var o=e.target;(function(e,t){return fetch("".concat(x.baseUrl,"cards/likes/").concat(e),{method:t,headers:x.headers}).then(w)})(n,o.classList.contains(k)?"DELETE":"PUT").then((function(e){o.classList.toggle(k),t.textContent=e.likes.length})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)}))}(e,f,c)})),i}function D(e,t,n,o,r,c,a){var u=U(e,t,n,o,r,c,a);i.prepend(u)}function T(e){e.submitter.setAttribute("disabled","disabled"),e.submitter.classList.add(L)}function j(e){e.classList.add(E),document.addEventListener("keydown",P)}function O(){u.forEach((function(e){e.classList.remove(E),document.removeEventListener("keydown",P)}))}function P(e){"Escape"===e.key&&(document.querySelector(E),O())}function B(e,t){var n=t.submitter;e?(n.textContent="Сохранение...",n.classList.remove(L)):(n.textContent="Сохранить",n.classList.add(L))}var N,I=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled","disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","disabled"))};function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}u.forEach((function(e){e.addEventListener("mousedown",(function(e){e.target.classList.contains(E)&&O(),e.target.classList.contains("pop-up__btn-close")&&O()}))})),t.addEventListener("click",(function(){j(s)})),e.addEventListener("click",(function(){m.value=n.textContent,v.value=o.textContent,j(l)})),f.addEventListener("submit",(function(e){e.preventDefault(),function(e){e.preventDefault();var t=m.value,r=v.value;B(!0,e),function(e,t){return fetch("".concat(x.baseUrl,"users/me"),{method:"PATCH",headers:x.headers,body:JSON.stringify({name:"".concat(e),about:"".concat(t)})}).then(w)}(t,r).then((function(){n.textContent=t,o.textContent=r,T(e),O()})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)})).finally((function(){B(!1,e)}))}(e)})),h.addEventListener("submit",(function(e){e.preventDefault(),function(e,t,n,o){B(!0,e),function(e,t){return fetch("".concat(x.baseUrl,"cards"),{method:"POST",headers:x.headers,body:JSON.stringify({name:"".concat(t),link:"".concat(e)})}).then(w)}(n,o).then((function(r){console.log(r);var c=r.likes,a=r.owner._id,i=r._id,u=[];c.forEach((function(e){u.push(e._id)})),D(n,o,c.length,a,a,i,u),T(e),O(),t.reset()})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)})).finally((function(){B(!1,e)}))}(e,h,_.value,b.value)})),c.addEventListener("mouseover",(function(){a.classList.add(C)})),c.addEventListener("mouseout",(function(){a.classList.remove(C)})),c.addEventListener("click",(function(){j(d)})),p.addEventListener("submit",(function(e){e.preventDefault(),function(e,t){e.preventDefault();var n,o=y.value;B(!0,e),(n=o,fetch("".concat(x.baseUrl,"users/me/avatar"),{method:"PATCH",headers:x.headers,body:JSON.stringify({avatar:"".concat(n)})}).then(w)).then((function(){r.src=o,T(e),O(),t.reset()})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)})).finally((function(){B(!1,e)}))}(e,p)})),N={formSelector:".pop-up__forms",inputSelector:".pop-up__profile-input",submitButtonSelector:".pop-up__btn-save",inactiveButtonClass:"pop-up__btn-save_inactive",inputErrorClass:"pop-up__profile-input_error"},Array.from(document.querySelectorAll(N.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);I(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),I(n,o,t)}))}))}(e,N)})),Promise.all([fetch("".concat(x.baseUrl,"users/me"),{headers:x.headers}).then(w),fetch("".concat(x.baseUrl,"cards"),{headers:x.headers}).then(w)]).then((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(o=n.next()).done)&&(c.push(o.value),!t||c.length!==t);a=!0);}catch(e){i=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw r}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),c=t[0],a=t[1];n.textContent=c.name,o.textContent=c.about,r.src=c.avatar;for(var i=function(e){var t=a[e].likes,n=a[e].owner._id,o=a[e]._id,r=[];t.forEach((function(e){r.push(e._id)})),D(a[e].link,a[e].name,t.length,c._id,n,o,r)},u=0;u<a.length;u++)i(u)})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)}))})();