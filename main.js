(()=>{"use strict";var e,t=document.querySelector(".profile__button-change"),n=document.querySelector(".profile__button-add"),o=(document.querySelectorAll(".pop-up__btn-close"),document.querySelector(".profile__title")),r=document.querySelector(".profile__subtitle"),c=document.querySelector(".profile__avatar"),a=document.querySelector(".profile__edit-avatar"),i=document.querySelector(".profile__avatar-change"),u=document.querySelector(".gallery__list"),l=document.querySelectorAll(".pop-up"),s=document.querySelector(".pop-up__profile"),d=document.querySelector(".pop-up__place"),f=document.querySelector(".pop-up__avatar"),p=document.querySelector("#profile-forms"),m=document.querySelector("#avatar-forms"),v=document.querySelector("#profile-name"),_=document.querySelector("#profile-description"),h=document.querySelector("#profile-avatar"),y=document.querySelector("#place-forms"),S=document.querySelector("#place-name"),b=document.querySelector("#place-description"),q=document.querySelector(".pop-up__image"),g=document.querySelector(".pop-up__gallery-image"),L=document.querySelector(".pop-up__desctiption-image"),E="pop-up__btn-save_inactive",C="pop-up_opened",k="profile__avatar-change_active",x="gallery__button-like_active",A=".gallery__item";function D(e,t,n,o,r,c,a){var i=function(e,t,n,o,r,c,a){var i=document.querySelector("#card").content.querySelector(A).cloneNode(!0),u=i.querySelector(".gallery__pic"),l=i.querySelector(".gallery__item-descriprion"),s=i.querySelector(".gallery__button-like"),d=i.querySelector(".gallery__button-delete"),f=i.querySelector(".gallery__show-like");return u.src="".concat(e),u.alt="".concat(t),u.dataset.id=c,l.textContent="".concat(t),f.textContent="".concat(n),u.addEventListener("click",(function(){g.src="".concat(e),g.alt="".concat(t),L.textContent="".concat(t),j(q)})),o===r?d.addEventListener("click",(function(e){!function(e){e.target.closest(A).remove()}(e),function(e){fetch("".concat(w.url,"/").concat(e),{method:"DELETE",headers:w.headers}).then(P).then((function(e){console.log(e)})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)}))}(c)})):d.remove(),a.includes(o)&&s.classList.add(x),s.addEventListener("click",(function(e){!function(e,t,n){var o=e.target;o.classList.contains(x)?(T(n,"DELETE"),t.textContent=+t.textContent-1):(T(n,"PUT"),t.textContent=+t.textContent+1),o.classList.toggle(x)}(e,f,c)})),i}(e,t,n,o,r,c,a);u.prepend(i)}var w={url:"https://nomoreparties.co/v1/plus-cohort-8/cards",urlUser:"https://nomoreparties.co/v1/plus-cohort-8/users/me",headers:{Authorization:"ea0f5ff1-1f3b-4f72-b28c-164c5b7a6982","Content-type":"application/json"}},P=function(e){return e.ok?e.json():Promise.reject(e)};function T(e,t){return fetch("".concat(w.url,"/likes/").concat(e),{method:t,headers:w.headers}).then(P).then((function(e){console.log(e)})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)}))}function j(e){e.classList.add(C),document.addEventListener("keydown",U)}function B(){l.forEach((function(e){e.classList.remove(C),document.removeEventListener("keydown",U)}))}function U(e){"Escape"===e.key&&(document.querySelector(C),B())}function N(e){document.querySelectorAll(".pop-up__btn-save").forEach((function(t){e?(t.textContent="Сохранение...",t.classList.remove(E)):(t.textContent="Сохранить",t.classList.add(E))}))}var O,J=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled","disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","disabled"))};l.forEach((function(e){e.addEventListener("mousedown",(function(e){e.target.classList.contains(C)&&B(),e.target.classList.contains("pop-up__btn-close")&&B()}))})),n.addEventListener("click",(function(){j(d)})),t.addEventListener("click",(function(){v.value=o.textContent,_.value=r.textContent,j(s)})),p.addEventListener("submit",(function(e){e.preventDefault(),e.submitter.setAttribute("disabled","disabled"),e.submitter.classList.add(E),function(e){e.preventDefault();var t=v.value,n=_.value;o.textContent=t,r.textContent=n,function(e,t){N(!0),fetch(w.urlUser,{method:"PATCH",headers:w.headers,body:JSON.stringify({name:"".concat(e),about:"".concat(t)})}).then(P).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)})).finally((function(){N(!1)}))}(t,n),B()}(e)})),y.addEventListener("submit",(function(t){var n,o;t.preventDefault(),t.submitter.setAttribute("disabled","disabled"),t.submitter.classList.add(E),n=S.value,o=b.value,N(!0),fetch(w.url,{method:"POST",headers:w.headers,body:JSON.stringify({name:"".concat(o),link:"".concat(n)})}).then(P).then((function(t){var r=t.likes,c=t.owner._id,a=t._id,i=[];return r.forEach((function(e){i.push(e._id)})),D(n,o,r.length,e,c,a,i)})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)})).finally((function(){N(!1)})),B(),y.reset()})),a.addEventListener("mouseover",(function(){i.classList.add(k)})),a.addEventListener("mouseout",(function(){i.classList.remove(k)})),a.addEventListener("click",(function(){j(f)})),m.addEventListener("submit",(function(e){e.preventDefault(),e.submitter.setAttribute("disabled","disabled"),e.submitter.classList.add(E),function(e){e.preventDefault();var t,n=h.value;c.src=n,t=n,N(!0),fetch("".concat(w.urlUser,"/avatar"),{method:"PATCH",headers:w.headers,body:JSON.stringify({avatar:"".concat(t)})}).then(P).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)})).finally((function(){N(!1)})),B()}(e),m.reset()})),O={formSelector:".pop-up__forms",inputSelector:".pop-up__profile-input",submitButtonSelector:".pop-up__btn-save",inactiveButtonClass:"pop-up__btn-save_inactive",inputErrorClass:"pop-up__profile-input_error"},Array.from(document.querySelectorAll(O.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);J(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),J(n,o,t)}))}))}(e,O)})),fetch(w.urlUser,{headers:w.headers}).then((function(e){return e.json()})).then((function(t){e=t._id,o.textContent=t.name,r.textContent=t.about,c.src=t.avatar})).then((function(){fetch(w.url,{headers:w.headers}).then(P).then((function(t){for(var n=function(n){var o=t[n].likes,r=t[n].owner._id,c=t[n]._id,a=[];o.forEach((function(e){a.push(e._id)})),D(t[n].link,t[n].name,o.length,e,r,c,a)},o=0;o<t.length;o++)n(o);return t})).catch((function(e){return console.log("Ошибка. Запрос не выполнен: ",e),Promise.reject(e)}))})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)}))})();